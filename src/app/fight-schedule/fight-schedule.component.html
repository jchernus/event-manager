<h1>Schedule</h1>

<ul class="nav nav-pills">
	<li class="nav-item">
    <a class="nav-link" [class.active]="viewMode==250" (click)="changeViewMode(250)">Heavyweight</a>
  </li>
	<li class="nav-item">
    <a class="nav-link" [class.active]="viewMode==30" (click)="changeViewMode(30)">Sportsman</a>
  </li>
	<li class="nav-item">
    <a class="nav-link" [class.active]="viewMode==15" (click)="changeViewMode(15)">Dogeweight</a>
  </li>
</ul>

<br>

<div *ngIf="auth.isAdmin(auth.user | async)">
  <h2>Add to Schedule</h2>
  <br>
  <h3>Fight:</h3>
  <div *ngIf="scheduleForm.errors" class="alert alert-danger">
    <p>You must select two unique bots.</p>
  </div>
  <form [formGroup]="scheduleForm" (ngSubmit)="scheduleFight()">
    <div class="form-row align-items-center">
      <div class="form-group">
        <label for="red">Red Square:</label>
        <select
          required
          [(ngModel)]="redBot"
          name="red"
          formControlName="red"
          id=""
          type="select"
          class="form-control"
          class="custom-select mr-sm-2">
          <option *ngFor="let robot of (robots | async)" value="{{robot.name}}">{{robot.name}}</option>
        </select>
      </div>
      <div class="vs">vs.</div>
      <div class="form-group">
        <label for="blue">Blue Square:</label>
        <select
          required
          [(ngModel)]="blueBot" 
          name="blue"
          formControlName="blue"
          id=""
          type="select"
          class="form-control"
          class="custom-select mr-sm-2">
          <option *ngFor="let robot of (robots | async)" value="{{robot.name}}">{{robot.name}}</option>
        </select>
      </div>
    </div>
    <button class="btn btn-primary">Schedule</button>
  </form>
  <br>
  <h3>Break:</h3>
  <form [formGroup]="breakForm" (ngSubmit)="scheduleBreak()">
    <div class="form-row align-items-center">
      <div class="form-group">
        <label for="breakTime">Duration:</label>
        <select
          required
          [(ngModel)]="breakDuration"
          name="breakTime"
          formControlName="breakTime"
          id=""
          type="select"
          class="form-control"
          class="custom-select mr-sm-2">
          <!-- <option *ngFor="let duration of durations" value="{{duration}}">{{duration}} minutes</option> -->
          <option value="5">5 minutes</option>
          <option value="10">10 minutes</option>
          <option value="30">30 minutes</option>
          <option value="60">60 minutes</option>
        </select>
      </div>
    </div>
    <button class="btn btn-primary">Add Break</button>
  </form>
</div>

<br>

<h2>Upcoming Matches</h2>

<div>
  <table class="table table-striped"> 
    <thead>
      <tr>
        <th>No.</th>
        <th>Red Square</th>
        <th>Blue Square</th>
        <!-- <th>Timestamp</th> -->
        <th *ngIf="auth.isAdmin(auth.user | async)">Controls</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let match of schedule | async as matches; let i = index;">
        <tr *ngIf="match.breakDuration !== undefined; else isFight">
          <td class="info">{{i+1}}</td>
          <td  class="info"colspan="2" align="center">
            {{match.breakDuration}} Minute Break
          </td>
          <td class="info" *ngIf="auth.isAdmin(auth.user | async)">
            <button 
              (click)="scheduleService.deleteBreak(match.id)"
              type="button" 
              class="btn btn-outline-danger">
                Delete Break
            </button>
          </td>
        </tr>
        <ng-template #isFight>
        <!-- <ng-container *ngIf="match.redSquare !== undefined"> -->
        <tr>
          <td>{{i+1}}</td>
          <td>{{match.redSquare}}</td>
          <td>{{match.blueSquare}}</td>
          <!-- <td>{{match.timestamp.toDate() | date:'medium'}}</td> -->
          <td *ngIf="auth.isAdmin(auth.user | async)">
            <button 
              (click)="scheduleService.deleteMatch(match.redSquare, match.blueSquare, match.id)"  
              type="button" 
              class="btn btn-outline-danger">
                Delete Match
            </button>
            
            <button 
              (click)="scheduleService.moveMatch(match.id, match.timestamp, matches[i-1].id, matches[i-1].timestamp)"
              type="button" 
              id="moveUp"
              class="btn btn-outline-info">
              &#9650;
            </button>
            
            <button 
              (click)="scheduleService.moveMatch(match.id, match.timestamp, matches[i+1].id, matches[i+1].timestamp)"
              type="button" 
              id="moveDown"
              class="btn btn-outline-info">
              &#9660;
            </button>
          </td>
        </tr>
        <!-- </ng-container> -->
        </ng-template>
      </ng-container>
    </tbody>
  </table>
</div>