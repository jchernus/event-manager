<h1>Results</h1>

<ul class="nav nav-pills">
	<li class="nav-item">
    <a class="nav-link" [class.active]="viewMode==250" (click)="changeViewMode(250)">Heavyweight</a>
  </li>
	<li class="nav-item">
    <a class="nav-link" [class.active]="viewMode==30" (click)="changeViewMode(30)">Sportsman</a>
  </li>
	<li class="nav-item">
    <a class="nav-link" [class.active]="viewMode==15" (click)="changeViewMode(15)">Dogeweight</a>
  </li>
</ul>

<div *ngIf="auth.isAdmin(auth.user | async)">
  <h4> Admin Controls</h4>
  <button class="btn btn-info" (click)="openResultsModal(resultsModal)">Add Result</button>
  <br>
  <br>
</div>

<!-- <br> -->

<!-- <h2>Fight Results</h2> -->
<!-- <br> -->
<div>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Winner</th>
        <th>Loser</th>
        <th>Win Condition</th>
        <th>Date/Time</th>
        <th *ngIf="auth.isAdmin(auth.user | async)">Controls</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let fight of fights | async">
        <td>{{fight.winner}}</td>
        <td>{{fight.loser}}</td>
        <td *ngIf="fight.ko; else jd">KO</td>
        <ng-template #jd>
          <td>JD</td>
        </ng-template>
        <td>{{fight.timestamp.toDate() | date:'medium'}}</td>
        <td *ngIf="auth.isAdmin(auth.user | async)">
          <button 
            (click)="fightService.deleteFight(fight)"  
            type="button" 
            class="btn btn-outline-danger">
              Delete Fight
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<ng-template #resultsModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="results-modal">Add Result</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div *ngIf="resultsForm.errors" class="alert alert-danger">
      <p>You must select two unique bots.</p>
    </div>
    <form [formGroup]="resultsForm" (ngSubmit)="addFight()">
      <div class="form-row align-items-center">
        <div class="form-group">
          <label for="winner">Winner:</label>
          <select
            required
            [(ngModel)]="winnerBot"
            name="winner"
            formControlName="winner"
            id=""
            type="select"
            class="custom-select mr-sm-2">
            <option *ngFor="let robot of (robots | async)" value="{{robot.name}}">{{robot.name}}</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="loser">Loser:</label>
          <select
            required
            [(ngModel)]="loserBot" 
            name="loser"
            formControlName="loser"
            id=""
            type="select"
            class="custom-select mr-sm-2">
            <option *ngFor="let robot of (robots | async)" value="{{robot.name}}">{{robot.name}}</option>
          </select>
        </div>
      </div>
      <div>
        <p>Win Condition:</p>
        <div class="form-check form-check-inline">
          <input 
            type="radio"
            class="form-check-input">
          <label class="form-check-label" for="ko">KO</label>
        </div>
        <div class="form-check form-check-inline">
          <input 
            [(ngModel)]="ko" 
            formControlName="jd"
            id="jd"
            name="jd"
            value="jd" 
            type="radio"
            class="form-check-input">
          <label class="form-check-label" for="jd">JD</label>
        </div>
        <div>
          <button class="btn btn-primary">Enter Results</button>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary" (click)="modal.dismiss()">Exit</button>
  </div>
</ng-template>